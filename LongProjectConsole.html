<!DOCTYPE html>
<!--Alex Le and Patrick Russel
	alhle/pcrussel-->
<html>
<head>
  <title>ADVENTURE</title><meta charset="utf-8">
  <style>
  body,div { background-color: #000; font-family: sans; padding: 1em; }
  </style>
</head>
<body>
<center>
<!--
   <font color=#0F0 size=16>
      <p id="console"></p>
   </font>
-->
<textarea id="console" rows="5" cols="100" style="resize:none; background-color: black; color: green; font-size: 16;">
</textarea>


<p></p>
<input type="text" id="input" value = "" size="75" />
<button onclick="enterFunction()">Enter</button>
</center>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js">
</script>
<script src="FayInterpreter.js">
</script>
<script>
//Fay strict object
var interp = Strict.FayInterpreter;

//JSON string object creation function


function StringCarrierMake(value) {
   var parseString = '{"instance": "StringCarrier", "thisValue": "';
   parseString = parseString + value;
   parseString = parseString + '"}';
   
   var returnValue = JSON.parse(parseString);
   return returnValue;
}

//global input and output variables
var console = document.getElementById("console");
var input = document.getElementById("input");

//current room id
var currentRoomId = 0;

//test rooms
//var currentRoom = new room("Starting Room", "This room is where you start");
//var northRoom = new room("North Room", "This room is north of the starting room");
//var startStringCarrier = StringCarrierMake("This is the starting room");
var northRoomCarrier = StringCarrierMake("This room is north of the starting room");

var startRoom = interp.roomMake(0, StringCarrierMake("This is the starting room"), [StringCarrierMake("north")], [1]);
var northRoom = interp.roomMake(1, StringCarrierMake("This room is north of the starting room"), [StringCarrierMake("south")], [0]);

var rooms = [startRoom, northRoom];

//function that interprets input and releases output
function enterFunction() {
      //check the input
	  if (input.value == "look" ){
//	     currentRoom.printRoom();
		 printRoom();
		 input.value = "";
	  }
	  else {
//	    alert ("Cake!");
	    parseCommand(input.value);
		input.value = "";
	  }
}

//function that prints the room to the console

function printRoom() {
	console.innerHTML = rooms[currentRoomId].desc;
}

//function that processes the command and sends it to Haskell, then parses the result value from Haskell
function parseCommand(command) {
	var commandCarrier = StringCarrierMake(command);
	
	var destID = interp.compareCommand(rooms[currentRoomId], commandCarrier);
//	alert (destID);
	if (destID != -1) {
		currentRoomId = destID;
		printRoom();
	}
	
}

//functionality that allows the user to hit "enter" rather than click the Enter button
$('input[type=text]').on('keydown', function(e) {
    if (e.which == 13) {
      enterFunction();   
      e.preventDefault();
    }
});

</script>


</html>
