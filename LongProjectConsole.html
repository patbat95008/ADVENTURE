<!DOCTYPE html>
<!--Alex Le and Patrick Russel
	alhle/pcrussel-->
<html>
<head>
  <title>ADVENTURE</title><meta charset="utf-8">
  <style>
  body,div { background-color: #000; font-family: sans; padding: 1em; }
  </style>
</head>
<body>
<center>
<!--
   <font color=#0F0 size=16>
      <p id="console"></p>
   </font>
-->
<textarea id="console" rows="5" cols="100" style="resize:none; background-color: black; color: green; font-size: 16;">
</textarea>


<p></p>
<input type="text" id="input" value = "" size="75" />
<button onclick="enterFunction()">Enter</button>
</center>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js">
</script>
<script src="FayInterpreter.js">
</script>
<script>
//Fay strict object
var interp = Strict.FayInterpreter;

//JSON string object creation function


function StringCarrierMake(value) {
   var parseString = '{"instance": "StringCarrier", "thisValue": "';
   parseString = parseString + value;
   parseString = parseString + '"}';
   
   var returnValue = JSON.parse(parseString);
   return returnValue;
}

//global input and output variables
var console = document.getElementById("console");
var input = document.getElementById("input");

//current room id
var currentRoomId = 0;

// rooms

//format: interp.roomMake(room#, StringCarrierMake("roomDesc."), [StringCarrierMake("connectionDirection")], [room# of connection])

var northRoomCarrier = StringCarrierMake("This room is north of the starting room");

var startRoom = interp.roomMake(0, StringCarrierMake("The entrance to the mansion. A dusty chandelier hangs from the ceiling, cobwebs draped over it. There's a door to the north."), [StringCarrierMake("north")], [1]);
var parlor = interp.roomMake(1, StringCarrierMake("A parlor. There's a piano in the corner, and empty bookshelves along the walls. There are doors to the south, north, east, and west."), 
		[StringCarrierMake("south"), StringCarrierMake("east"), StringCarrierMake("north"), StringCarrierMake("west")], [0, 2, 4, 5]);

var library = interp.roomMake(2, StringCarrierMake("A huge library. The walls are lined with thousands upon thousands of books. Upon closer inspection, you notice most of them are cookbooks.\n There is are doors to the east and the north."), 
		[StringCarrierMake("east"), StringCarrierMake("north")], [1, 3]);

var study = interp.roomMake(3, StringCarrierMake("This study looks like it's been used heavily by someone. Notes and drawing are strewn about everywhere.\n There is a door to the south."), 
		[StringCarrierMake("south")], [2]);

var livingRoom = interp.roomMake(4, StringCarrierMake("This room is coated in dust and smells of old people. Nobody's used it in a long time.\n There's are doors to the north and south"), 
		[StringCarrierMake("south"), StringCarrierMake("north")], [1, 8]);

var sunRoom = interp.roomMake(5, StringCarrierMake("There's something odd about this room.\n The large windows are all covered in black paint.\n A bucket of paint sits in the corner. There are doors to the west and north"), 
		[StringCarrierMake("west")], [1]);

var garden = interp.roomMake(6, StringCarrierMake("You find yourself outside in a beautiful garden. It's full of plants you've never seen before!\n One particular flower catches your eye.\n The mansion's sun room is to the south, and the pool to the east"), 
		[StringCarrierMake("south"), StringCarrierMake("east")], [5, 7]);

var pool = interp.roomMake(7, StringCarrierMake("An empty pool sits before you, a pile of leaves gather at the bottom.\n You spy a contraption sitting there as well.\n The garden is to the west."), 
		[StringCarrierMake("west")], [6]);

var doorRoom = interp.roomMake(8, StringCarrierMake("This room is absolutly filled with doors!\n Choices... choices...\n There are doors to the north, south, east, and west."), 
		[StringCarrierMake("north"), StringCarrierMake("south"), StringCarrierMake("east"), StringCarrierMake("west")], [11, 4, 9, 10]);

var fireRoom = interp.roomMake(9, StringCarrierMake("Who turned up the heat? It's so hot the furniture is melting!\n A bright red bulb hangs at the center of this room.\n There is a door to the west."), 
		[StringCarrierMake("west")], [8]);

var iceRoom = interp.roomMake(10, StringCarrierMake("This room is frozen solid.\n An ice block sits in a place of prominence.\n A door leads east."), 
		[StringCarrierMake("east")], [10]);

var kingRoom = interp.roomMake(11, StringCarrierMake("This is it...\n Before you stands the great King Joe, ruler of the mansion.\n He looks at you, dazed, and says, \"How did you come this far? Oh well, have at thee!\"\n Thankfully, he's too slow to really get you.\n A single door leads south."), 
		[StringCarrierMake("south")], [10]);

var rooms = [startRoom, parlor, library, study, livingRoom, sunRoom, garden, pool, doorRoom, fireRoom, iceRoom, kingRoom];

//function that interprets input and releases output
function enterFunction() {
      //check the input
	  if (input.value == "look" ){
//	     currentRoom.printRoom();
		 printRoom();
		 input.value = "";
	  }
	  else {
//	    alert ("Cake!");
	    parseCommand(input.value);
		input.value = "";
	  }
}

//function that prints the room to the console

function printRoom() {
	console.innerHTML = rooms[currentRoomId].desc;
}

//function that processes the command and sends it to Haskell, then parses the result value from Haskell
function parseCommand(command) {
	var commandCarrier = StringCarrierMake(command);
	
	var destID = interp.compareCommand(rooms[currentRoomId], commandCarrier);
//	alert (destID);
	if (destID != -1) {
		currentRoomId = destID;
		printRoom();
	}
	
}

//functionality that allows the user to hit "enter" rather than click the Enter button
$('input[type=text]').on('keydown', function(e) {
    if (e.which == 13) {
      enterFunction();   
      e.preventDefault();
    }
});

</script>


</html>
